[
{
	"uri": "/vi/1-intro/",
	"title": "Giới thiệu",
	"tags": [],
	"description": "",
	"content": "Tổng quan Với Amazon GuardDuty, một dịch vụ được quản lý hoàn toàn bởi AWS, bài thực hành này sẽ khái quát làm thế nào để phát hiện những mối nguy hại đến hệ thống và khắc phục chúng. Chúng ta sẽ tiến hành phân tích, đánh giá và làm thế nào để báo động cũng như khắc phục các vấn đề bảo mật dựa trên những phát hiện (Findings) của GuardDuty.\nNhằm chuẩn bị cho bài thực hành này, bằng cách sử dụng CloudFormation Template có sẵn, chúng ta sẽ tái hiện những cuộc tấn công và cách khắc phục tự động bằng việc kết hợp giữa EventBridge Event Rules và Lambda Functions.\n Cấp độ: 300 Thời lượng: 1-2 tiếng Điều kiện cần: IAM User (Admin) và AWS CLI Các chức năng của CSF (Cybersecurity Framework):  Bảo vệ (Protect) Phát hiện (Detect) Phản hồi (Respond)   Các góc nhìn bảo mật của CAF (Cloud Adoption Framework):  Preventative (Khả năng phòng chống) Detective (Khả năng truy vết) Responsive (Khả năng phản ứng)   Các dịch vụ AWS được sử dụng:  Amazon EventBridge Amazon GuardDuty AWS CloudTrail AWS Lambda VPC Security Groups Amazon SNS    Thiết lập  Bài thực hành sẽ được thiết lập ở us-west-2 (Oregon).\n Chi tiết xem thêm ở phần Thiết lập môi trường.\nTình Huống Bài thực hành sẽ bao gồm các tình huống như sau:\n   Thứ tự Tên Đặc tả Giải pháp     1 Compromised EC2 instance Phát hiện và hồi phục EC2 instance bị tấn công Sự kết hợp giữa Amazon GuardDuty, Amazon EventBridge Event Rules và AWS Lambda   2 Compromised IAM credentials Xác định một cá nhân đang chủ động gọi API đến hệ thống trên AWS Khắc phục mối nguy hại này ngay lập tức một cách thủ công (manually)   3 IAM role exfiltration Thông qua một credential bị rò rỉ, một cá nhân đang cố gắng xâm nhập và gọi API từ một máy chủ bên ngoài Tiến hành khắc phục với AWS Lambda    Dọn Dẹp Chi tiết ở phần Dọn dẹp môi trường.\n"
},
{
	"uri": "/vi/",
	"title": "Làm quen với Amazon GuardDuty thông qua thực hành",
	"tags": [],
	"description": "",
	"content": "Làm quen với Amazon GuardDuty thông qua thực hành Tổng quan Với Amazon GuardDuty, một dịch vụ được quản lý hoàn toàn bởi AWS, bài thực hành này sẽ khái quát làm thế nào để phát hiện những mối nguy hại đến hệ thống và khắc phục chúng. Chúng ta sẽ tiến hành phân tích, đánh giá và làm thế nào để báo động cũng như khắc phục các vấn đề bảo mật dựa trên những phát hiện (Findings) của GuardDuty.\nNhằm chuẩn bị cho bài thực hành này, bằng cách sử dụng CloudFormation Template có sẵn, chúng ta sẽ tái hiện những cuộc tấn công và cách khắc phục tự động bằng việc kết hợp giữa EventBridge Event Rules và Lambda Functions.\n Cấp độ: 300 Thời lượng: 1-2 tiếng Điều kiện cần: IAM User (Admin) và AWS CLI Các chức năng của CSF (Cybersecurity Framework):  Bảo vệ (Protect) Phát hiện (Detect) Phản hồi (Respond)   Các góc nhìn bảo mật của CAF (Cloud Adoption Framework):  Preventative (Khả năng phòng chống) Detective (Khả năng truy vết) Responsive (Khả năng phản ứng)   Các dịch vụ AWS được sử dụng:  Amazon EventBridge Amazon GuardDuty AWS CloudTrail AWS Lambda VPC Security Groups Amazon SNS    Thiết lập  Bài thực hành sẽ được thiết lập ở us-west-2 (Oregon).\n Chi tiết xem thêm ở phần Thiết lập môi trường.\nTình Huống Bài thực hành sẽ bao gồm các tình huống như sau:\n   Thứ tự Tên Đặc tả Giải pháp     1 Compromised EC2 instance Phát hiện và hồi phục EC2 instance bị tấn công Sự kết hợp giữa Amazon GuardDuty, Amazon EventBridge Event Rules và AWS Lambda   2 Compromised IAM credentials Xác định một cá nhân đang chủ động gọi API đến hệ thống trên AWS Khắc phục mối nguy hại này ngay lập tức một cách thủ công (manually)   3 IAM role exfiltration Thông qua một credential bị rò rỉ, một cá nhân đang cố gắng xâm nhập và gọi API từ một máy chủ bên ngoài Tiến hành khắc phục với AWS Lambda    Dọn Dẹp Chi tiết ở phần Dọn dẹp môi trường.\nNội dung  Thiết lập môi trường GuardDuty Hoạt Động Như Thế Nào? Tình huống 1: Compromised EC2 instance Tình huống 2: Compromised IAM credentials Tình huống 3: IAM role exfiltration Tóm lược Dọn dẹp môi trường  "
},
{
	"uri": "/vi/6-iam-role-credential-exfiltration/1-create-findings/",
	"title": "Tạo các Finding",
	"tags": [],
	"description": "",
	"content": "Tạo ra Finding một cách thủ công\nCác cuộc tấn công giả lập và Findings sẽ được tự động tạo ra từ CloudFormation Template, ngoài trừ một Finding. Đối với Finding này, bạn sẽ cần phải làm một số bước cụ thể như:\n Sao chép IAM security credential tạm thời từ EC2 instance. Thực hiện gọi API từ máy tính cá nhân một cách thủ công.   Để tạo ra Finding này, chúng ta phải thực hiện gọi API đến từ bên ngoài hệ thống mạng của AWS.\n Nội dung\n Truy xuất IAM security credential tạm thời với Systems Manager Tạo AWS CLI Profile trên máy tính cá nhân Thực hiện câu lệnh AWS CLI bằng IAM security credential tạm thời  Truy xuất IAM security credential tạm thời với Systems Manager Để tiến hành giả lập cuộc tấn công cuối cùng này, bạn cần phải truy xuất thành công IAM security credential tạm thời được sinh ra bởi IAM role thuộc EC2 instance. Chúng ta có thể thử 1 trong 2 cách sau:\n Truy cập SSH vào EC2 instance và tiến hành truy vấn dữ liệu Metadata của EC2 instance. Sử dụng chức năng Session Manager của dịch vụ AWS System Manager.  Truy cập vào System Manager Console ở us-west-2. Ở thanh điều hướng bên tay trái, chọn Fleet Manager, chúng ta sẽ thấy một managed EC2 instance với định dạng tên như sau - GuardDuty-Example: Compromised Instance: Scenario 3 với trạng thái SSM Agent ping status là Online.    Tiến hành sử dụng chức năng Session Manager bằng cách nhấn nút Instance actions và chọn Start Session.  Thực hiện câu lệnh truy vấn dữ liệu Metadata:  curl http://169.254.169.254/latest/meta-data/iam/security-credentials/GuardDuty-Example-EC2-Compromised Tiến hành ghi chú một số thông tin quan trọng sau  Access Key ID Secret Access Key Session Token    Tạo AWS CLI Profile trên máy tính cá nhân Sau khi thành công truy xuất IAM security credential tạm thời, chúng ta sẽ tiến hành tạo một AWS CLI Profile trên máy tính cá nhân. Từ Terminal/CMD/PowerShell, chúng ta tiến hành thay thế các \u0026lt;PLACEHOLDER\u0026gt; với giá trị cụ thể đã thu thập, sau đó thực hiện nhập các lệnh sau:\naws configure set profile.badbob.region us-west-2 aws configure set profile.badbob.aws_access_key_id \u0026lt;ACCESS_KEY_ID\u0026gt; aws configure set profile.badbob.aws_secret_access_key \u0026lt;SECRET_ACCESS_KEY\u0026gt; aws configure set profile.badbob.aws_session_token \u0026lt;SESSION_TOKEN\u0026gt;  Chúng ta có thể kiểm tra xem nếu Profile đã được tạo hay chưa bằng việc truy cập đến nơi chứa các AWS security credentials.\n Chúng ta có thể sử dụng câu lệnh sau để tiến hành kiểm tra nhanh xem đã có AWS CLI Profile tên là badbob hay chưa.\naws configure --profile badbob Thực hiện câu lệnh AWS CLI bằng IAM security credential tạm thời Bằng các câu lệnh AWS CLI dưới đây, chúng ta tiến hành thực hiện gọi API đến những dịch vụ AWS khác nhau.\n IAM user có bất kỳ quyền hạn nào?\naws iam get-user --profile badbob aws iam create-user --user-name Chuck --profile badbob  Liệu có quyền truy cập đến DynamoDB?\naws dynamodb list-tables --profile badbob aws dynamodb describe-table --table-name GuardDuty-Example-Customer-DB --profile badbob  Liệu có quyền truy vấn dữ liệu đến DynamoDB?\naws dynamodb scan --table-name GuardDuty-Example-Customer-DB --profile badbob aws dynamodb put-item --table-name GuardDuty-Example-Customer-DB --item \u0026#39;{\u0026#34;name\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;Joshua Tree\u0026#34;},\u0026#34;state\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;Michigan\u0026#34;},\u0026#34;website\u0026#34;:{\u0026#34;S\u0026#34;:\u0026#34;https://www.nps.gov/yell/index.htm\u0026#34;}}\u0026#39; --profile badbob aws dynamodb scan --table-name GuardDuty-Example-Customer-DB --profile badbob aws dynamodb delete-table --table-name GuardDuty-Example-Customer-DB --profile badbob aws dynamodb list-tables --profile badbob  Liệu có thể truy cập đến System Manager Parameter Store?\naws ssm describe-parameters --profile badbob aws ssm get-parameters --names \u0026#34;gd_prod_dbpwd_sample\u0026#34; --profile badbob aws ssm get-parameters --names \u0026#34;gd_prod_dbpwd_sample\u0026#34; --with-decryption --profile badbob aws ssm delete-parameter --name \u0026#34;gd_prod_dbpwd_sample\u0026#34; --profile badbob "
},
{
	"uri": "/vi/2-environment-setup/",
	"title": "Các bước chuẩn bị",
	"tags": [],
	"description": "",
	"content": "\rBài thực hành sẽ được thiết lập ở us-west-2 (Oregon).\n\rContents\n Điều kiện cần Triển khai Tài nguyên AWS được chuẩn bị?  Điều kiện cần  Tài khoản AWS: Một tài khoản dành cho môi trường TESTING. Quyền hạn Administrator: Bảo đảm rằng bạn đang sử dụng một IAM user với quyền hạn Administrator. AWS CLI: Bảo đảm rằng bạn sẵn sàng sử dụng AWS CLI cho mục đích giả lập các cuộc tấn công từ máy tính của mình.  Triển khai  Kích hoạt Amazon GuardDuty\n Đăng nhập vào AWS Console, truy cập vào dịch vụ GuardDuty. Bắt đầu bằng cách chọn Get Started.  Đối với tài khoản mới, AWS sẽ cho chúng ta 30 ngày dùng thử, để bắt đầu sử dụng, nhấn chọn nút Enable GuardDuty.   Chuẩn bị tài nguyên với AWS CloudFormation\n Đăng nhập vào AWS Console, truy cập vào dịch vụ CloudFormation Tiến hành tạo một Stack mới bằng việc nhấn nút Create Stack. Ở trang Specify template,   Tải template tại đây Tiến hành tải lên Temlate có sẵn bằng cách dùng nút Upload a template file.  Ở trang Parameters, chúng ta sẽ nhập một số thông tin bắt buộc sau:  EmailAddress: Tài khoản Email cá nhân để có thể nhận thông báo.    Ở trang Specify Stack Details, chọn nút Next. Ở trang Configure stack options, chọn nút Next. Ở trang Capabilities, tiến hành chấp nhận (Acknowledge) cho phép Template tạo các IAM role, cuối cùng chọn nút Create Stack.  Quá trình trên sẽ diễn ra trong vòng 5-10 phút cho tới khi chúng ta thấy được trạng thái của Stack là CREATE_COMPLETE. Sau đó, chúng ta sẽ nhận được một thông báo qua Email với chủ đề tương tự AWS Notification - Subscription Confirmation.\n\rNhững kết quả ban đầu sẽ bắt đầu hiển thị sau 10 phút kể từ thời điểm thiết lập CloudFormation Stack hoàn thành.\nTài nguyên AWS được chuẩn bị? CloudFormation Template sẽ chuẩn bị cho chúng ta các tài nguyên sau:\n Dịch vụ EC2:  2 instances với tên gọi là Compromised Instance. 1 instance với tên gọi là Malicious Instance.   Dịch vụ IAM:  1 IAM Role dành cho EC2 instance với quyền hạn truy cập đến SSM Parameter Store và DynamoDB.   Dịch vụ SNS:  1 SNS Topic gửi thông báo qua E-mail.   Dịch vụ EventBridge:  3 EventBridge Events Rules cho việc kích hoạt các thông báo và quá trình khắc phục.   Dịch vụ Lambda:  2 Lambda Functions tiến hành khắc phục các lỗ hổng.   Dịch vụ SSM:  1 SSM Parameter Store dùng để chứa mật khẩu cho môi trường TESTING.    "
},
{
	"uri": "/vi/6-iam-role-credential-exfiltration/2-senario/",
	"title": "Credential Exfiltration",
	"tags": [],
	"description": "",
	"content": "Contents\n Kiến Trúc Tổng Quan Quá Trình Điều Tra Câu Hỏi Ôn Tập  Kiến Trúc Tổng Quan  Máy chủ từ xa truy cập đến EC2 compromised instance và đánh cắp IAM role credential thông qua dữ liệu Metadata. Máy chủ này thiết lập AWS CLI Profile để tiến hành gọi API đến tài khoản AWS. GuardDuty sinh ra những Findings liên quan và đồng thời gửi tới GuardDuty console và EventBridge Events. EventBridge Event Rule kích hoạt SNS Topic và Lambda Function. SNS Topic tiến hành gửi thông báo E-mail với chi tiết Finding. Lambda Function tiến hành gán một chính sách mới nhằm thu hồi mọi Sessions đang hoạt động.  Quá Trình Điều Tra  Truy cập GuardDuty Console\nĐể tiến hành xem xét các Findings:\n Truy cập vào GuardDuty Console ở us-west-2 Chúng ta sẽ thấy được Findings với định dạng như sau - UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration.  Nếu không có bất kỳ Finding nào, tiến hành nhấn nút Refresh và đợi. Từ Finding - UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration, chúng ta có thể dễ dàng truy xuất một số thông tin sau:  High Severity Thông báo rằng có người cố ý sử dụng IAM role credential ở ngoài EC2 instance     Mỗi GuardDuty Finding sẽ được gán một mức độ nghiêm trọng cụ thể - Low/Medium/High. Các mức độ này được định nghĩa bởi AWS, chúng được dùng để phân loại và xác định\n  Kiểm tra EventBridge Event Rule\n Truy cập vào CloudWatch Console ở us-west-2. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event.. Tiến hành chọn quy tắc có tên là GuardDuty-Event-IAMUser-InstanceCredentialExfiltration.  Ở mục Event Pattern, chúng ta dễ dàng thấy được nguồn dữ liệu mà Event này sẽ ghi nhận và tiến hành kích hoạt các Target khi có bất kỳ sự kiện nào.   Bạn có thể tạo EventBridge Event Rule nhằm ghi nhận sự kiện của một loại Finding cụ thể hay bất kỳ loại Finding nào.\n Sau đây là một ví dụ nhằm ghi nhận bất kỳ sự kiện nào thuộc GuardDuty Findings.\n{\r\u0026#34;detail-type\u0026#34;: [\r\u0026#34;GuardDuty Finding\u0026#34;\r],\r\u0026#34;source\u0026#34;: [\r\u0026#34;aws.guardduty\u0026#34;\r]\r}  Kiểm tra quá trình Remediation với Lambda Function\nAlice đã thiết lập quá trình Remediation nhằm phản ứng tự động với mối nguy hại này thông qua Lambda function. Chúng ta có thể kiểm tra đoạn mã được lập trình để hiểu thêm về quá trình này.\n Truy cập vào Lambda Console ở us-west-2. Ở thanh điều hướng bên tay trái, chọn Functions và tìm kiếm GuardDuty-Example-Remediation-InstanceCredentialExfiltration.  Về cơ bản, Lambda function này sẽ truy xuất thông tin về IAM Role từ Finding và tiến hành thêm IAM Policy.   Những Permissions nào mà Lambda Function cần để thực hiện quá trình Remediation? Liệu có rủi ro nào có thể xảy ra với cấp độ Permissions hiện tại?\n  Kiểm chứng quá trình Remediation\nĐể tiến hành kiểm chứng liệu Finding InstanceCredentialExfiltration đã được giải quyết triệt để, chúng ta sẽ lần lượt tiến hành các bước sau.\n Kiểm chứng thông qua AWS CLI  Tiến hành thực thi câu lệnh sau:\naws dynamodb list-tables --profile badbob Chúng ta sẽ nhận được kết quả trả về sẽ là AccessDeniedException cho câu lệnh thực thi.\n Kiểm chứng thông qua AWS Console  Tiến hành đánh giá IAM Policy đã được thêm vào IAM Role trong quá trình Remediation.\n Truy cập vào IAM Console. Ở thanh điều hướng bên tay trái, chọn Roles và tìm kiếm GuardDuty-Example-EC2-Compromised. Đây là IAM Role mà chúng ta sẽ xác định được thông qua GuardDuty Finding.  Bấm chọn thanh Permissions, nhấn vào chính sách IAM Policy RevokeOldSessions.  Câu Hỏi Ôn Tập  Có những rủi ro liên quan nào xuất hiện trong quá trình Remediation? Liệu có những EC2 instances khác cũng sử dụng IAM Role này không?  "
},
{
	"uri": "/vi/3-how-it-works/",
	"title": "Về GuardDuty",
	"tags": [],
	"description": "",
	"content": "Nội dung\n Nguồn Dữ liệu Findings  Nguồn Dữ liệu Kể từ khi được kích hoạt trong một AWS Region, GuardDuty tiến hành phân tích mọi dữ liệu đến từ:\n VPC Flow Logs CloudTrail Logs DNS Logs  Nhật ký lưu trữ của DNS xuất phát từ các DNS resolvers (sở hữu bởi AWS) dành cho các VPC và không thể truy xuất trực tiếp từ phía người dùng. Nếu như DNS resolver được cấu hình độc lập bởi chính bạn hoặc từ phía bên thứ 3, GuardDuty sẽ không thể truy xuất, xử lý và xác định các mối nguy hại từ nguồn dữ liệu này.    GuardDuty có thể truy xuất đến mọi nguồn dữ liệu (được đề cập ở trên) cho dù chúng chưa được kích hoạt từ trước.\nAWS khuyên bạn nên kích hoạt đồng thời CloudTrail Logs và VPC Flow Logs để có cái nhìn tổng quan và chi tiết nhất khi tiến hành phân tích dữ liệu.\n\rGuardDuty là một dịch vụ mang tính chất Regional, thế nên để có thể theo dõi dữ liệu ở một AWS Region thì bạn phải kích hoạt ở AWS Region đó.\nBạn có thể kích hoạt thông qua AWS Console hoặc sử dụng APIs. Đa số người dùng sẽ kích hoạt ở mọi AWS Regions và AWS Accounts một cách đồng thời thông qua APIs.\n\rCho dù bạn có số lượng các tài nguyên AWS ít hay nhiều (ví dụ như VPCs hay IAM users), GuardDuty sẽ không gây bất kỳ ảnh hưởng nào đến bất kỳ tài nguyên nào bởi các quy trình xử lý sẽ chỉ được thực hiện nội bộ bên trong dịch vụ GuardDuty.\nGuardDuty là một dịch vụ được quản lý hoàn toàn bởi AWS.\n\rCách tính giá của GuardDuty sẽ dựa trên\n Số lượng CloudTrail events được phân tích Khối lượng của VPC floư logs (theo GB) Khối lượng của DNS log (theo GB)  Mỗi tài khoản AWS sẽ có 30 ngày thử nghiệm ở mỗi AWS Region, điều này sẽ giúp GuardDuty dễ dàng dự đoán chi phí phát sinh.\n\rFindings GuardDuty sẽ chủ động quan sát và theo dõi các dấu hiệu bất thường xuất phát\n Từ 3 nguồn dữ liệu (được đề cập ở trên) Từ các EC2 instances Từ các tài nguyên AWS IAM  Bạn sẽ dễ dàng truy xuất chi tiết các Findings được phát hiện bởi GuardDuty ở thanh Findings. Mỗi Finding sẽ được chia nhỏ thành nhiều thông tin theo định dạng mà cho phép chúng ta dễ dàng đọc hiểu và xử lý các nguy cơ về bảo mật.\nThreatPurpose : ResourceTypeAffected / ThreatFamilyName . ThreatFamilyVariant ! Artifact \rTìm hiểu chi tiết hơn về các thành phần của định dạng trên tại đây.\n\rĐối với những trường hợp và hành vi có mức độ khó đoán cao, để mà có thể học chúng và phân tích những điểm bất thường, bộ máy Machine Learning của GuardDuty sẽ cần một khoảng thời gian cơ sở từ 7 đến 14 ngày.\n**Ví dụ: **\n Một EC2 instance bắt đầu giao tiếp với một máy chủ từ xa thông qua một Port bất thường. Một IAM user bắt đầu thay đổi Route Tables trong khi trước đó chưa từng thực hiện tác vụ này.  Đối các truờng hợp trên, mọi tác vụ tìm kiếm đều sẽ được dựa trên các Signatures, vì vậy chúng sẽ được phát hiện trong vòng 10 phút kể từ khi CloudFormation stack được hoàn thành. Trong quá trình phát hiện mối nguy hại, sự chậm trễ sẽ là ít hay nhiều dựa trên tần suất xuất hiện của các thông tin liên quan và tổng thời gian mà GuardDuty có thể truy xuất và phân tích các thông tin ấy tại các nguồn dữ liệu cụ thể.\nTìm hiểu chi tiết hơn về danh sách của toàn bộ các loạt GuardDuty Findings tại đây\n\rKhi có bất kỳ sự thay đổi nào tại các Findings, dựa trên các thiết lập đến từ Amazon CloudWatch Events, GuardDuty sẽ gửi thông báo đến bạn ngay tức thì trong vòng 5 phút. Mọi sự thay đổi liên quan từ các lần kế tiếp sẽ có cùng ID với Finding gốc và thông báo sẽ được gửi mỗi 6 tiếng tính từ lần gửi đầu tiên, điều này nhằm đối phó với lượng thông báo đến ồ ạt trong cùng một Finding đến người dùng.\n"
},
{
	"uri": "/vi/4-compromised-ec2-instance/",
	"title": "Compromised EC2 Instance",
	"tags": [],
	"description": "",
	"content": "Tình huống 1: Compromised EC2 Instance\nNhư thường lệ, bạn đến văn phòng sớm vào sáng Thứ 2, chuẩn bị một tách cà phê, ngồi vào chỗ và mở laptop, bắt đầu một chuỗi những tác vụ thường nhật như gửi E-mail, viết kế hoạch. Đột nhiên, bạn bắt đầu nhận một chuỗi những E-mails với nội dung liên quan đến sự phát hiện mới nhất đối với các mối nguy hại, điều mà bạn chưa từng thấy trước đây, tuy nhiên bạn bắt đầu tìm hiểu và điều tra ngay lập tức. Điều đáng mừng là đồng nghiệp của bạn, Alice đã thiết lập những phản ứng tự động dành cho những Findings ấy thế nên chúng đã được giải quyết tức.\nNội dung E-mail đầu tiên mà bạn được nhận được với việc EC2 instance của bạn có thể đã bị xâm nhập như sau:\nGuardDuty Finding | ID: 1xx: The EC2 instance i-xxxxxxxxx may be compromised and should be investigated Nội dung E-mail thứ hai ngay sau đó mà bạn nhận được với tình hình đã được giải quyết tức thì như sau:\nGuardDuty Remediation | ID: 1xx: GuardDuty discovered an EC2 instance (Instance ID: i-xxx) that is communicating outbound with an IP Address on a threat list that you uploaded. All security groups have been removed and it has been isolated. Please follow up with any additional remediation actions. Nội dung\n Kiến trúc tổng quan Quá Trình Điều tra Câu Hỏi Ôn Tập  Kiến trúc tổng quan  Một EC2 compromised instance, tiến hành gửi gói tin pings đến địa chỉ EIP của một EC2 instance nguy hại. Địa chỉ EIP đó đã được thêm ở Custom Threat List. GuardDuty tiến hành theo dõi VPC Flow Logs (kể cả CloudTrail và DNS Logs) và phân tích tình hình dựa trên Machine Learning, Custom Threat List và một số cở sở khác. GuardDuty sinh ra một Finding và hiển thị trên GuardDuty Console và gửi sự kiện này đến EventBridge Events. Dựa trên sự kiện này, EventBridge Event Rule tiến hành phản ứng và kích hoạt đồng thời SNS Topic và Lambda Function tương ứng. SNS Topic sẽ gửi E-mail cùng với chi tiết Finding cho bạn. Lambda Function sẽ tiến hành cô lập EC2 compromised instance.  Khi Alice thiết lập thông báo E-mail cho sự kiện này, cô ấy chỉ thêm một vài thông tin nhất định về Finding ấy và cấu hình Lambda Function để tự động cô lập EC2 compromised instance. Mặc dù Finding đã được giải quyết, bạn vẫn quyết định tìm hiểu chi tiết hơn về các thiết lập và cấu hình hiện tại này của Alice.\nQuá Trình Điều tra  Truy cập GuardDuty Console\nMặc dù bạn có thể thấy các Findings này từ GuardDuty Console, đa số các khách hàng đều muốn tập hợp chúng, từ các AWS Regions và AWS Accounts, đến một hệ thống quản lý dữ liệu bảo mật tập trung (SIEM) để tiến hành phân tích và thực hiện quá trình Remediations. Cách tiếp cận thông dụng nhất là cấu hình GuardDuty dưới một mô hình Admin/Member và sử dụng quy trình kết hợp giữa EventBridge Event Rules và Lambda Function để tiến hành đẩy những Findings này tới SIEM hoặc một Centralized Logging Framework. Ngoài ra còn có một số giải pháp đến từ các đối tác của AWS, giúp khách hàng thực hiện các tác vụ hợp nhất và đẩy dữ liệu dễ dàng nhất.\n Truy cập vào GuardDuty Console ở us-west-2 Chúng ta sẽ thấy được một Finding với định dạng như sau UnauthorizedAccess:EC2/MaliciousIPCaller.Custom.  Nếu không có bất kỳ Finding nào, tiến hành nhấn nút Refresh và đợi.   Người dùng có thể truy xuất các Findings ở GuardDuty console trong vòng 90 ngày.\n  Dựa trên định dạng đã được xem xét chi tiết ở phần trước, bạn có thể xác định chính xác sự cố bảo mật nào thông qua kiểu Finding?\n  Trong môi trường của bạn, kiểu Finding này chỉ ra rằng một EC2 instance đang thực hiện quá trình giao tiếp tới địa chỉ IP (đã được thêm vào Threat Lists). Tiến hành chọn Lists ở thanh điều hướng (bên tay trái) để có thể xem Threat List mà Alice đã thêm trước đây - Example-Threat-List.   GuardDuty sử dụng những hệ thống Threat Intelligence được cung cấp bởi đội ngũ AWS Security và bên thứ 3 như ProofPoint và CrowdStike. Bạn có thể mở rộng tầm quan sát của GuardDuty bằng cách tự cấu hình danh sách IP đáng tin cậy (Trusted IP Lists) và danh sách các mối nguy hại (Threat Lists). Nếu bạn đã thiết lập GuardDuty theo cấu trúc Admin/Member, từ tài khoản GuardDuty Admin, bạn có thể quản lý các danh sách trên và để các tài khoản Members kế thừa. Mặc nhiên, các tài khoản Members sẽ không quyền chỉnh sửa các danh sách này.\n Trong tình huống giả lập này, EC2 compromised instance chỉ tiến hành truy cập đến EIP của một EC2 instance khác trong cùng VPC nhằm nội bộ hoá quá trình giả lập cùng luồng xử lý dữ liệu chỉ xảy ra trong môi trường của bạn. CloudFormation Template sẽ tự động tạo danh sách mối nguy hại (Threat Lists) và gán địa chỉ EIP này vào đó.\n\r Kiểm tra EventBridge Event Rule\nAlice sử dụng EventBridge Event Rules để gửi thông báo đến bạn về các Findings cùng với nội dung các bước của quá trình Remediations. Chúng ta sẽ tiến hành khảo sát chi tiết hơn để hiểu rõ Alice đã thiết lập những gì và quá trình này diễn ra như thế nào?\n Truy cập vào EventBridge Console ở us-west-2. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event.  Tiến hành chọn quy tắc có tên là GuardDuty-Event-EC2-MaliciousIPCaller.  Bạn sẽ dễ dàng nhận thấy có 2 mục tiêu tại vùng Targets.  Lambda Function SNS Topic: Tiến hành gửi thông báo E-mail cho bạn dựa trên dữ liệu được cung cấp bởi EventBridge Event Rule. Thay vì toàn bộ dữ liệu JSON được sử dụng, bằng việc sử dụng Input Transformer, Alice đã tuỳ chỉnh nội dung thông báo.     Kiểm tra quá trình Remediation dựa trên Lambda Function\nLambda Function là chìa khoá nắm giữ logic nhằm thực hiện các bước của quá trình Remediations dành cho các Findings. Alice đã thiết lập Lambda Function nhằm loại bỏ và thay thế Security Group của EC2 compromised instance bằng một Security Group không chứa bất kỳ một quy tắc Ingress/Egress nào. Điều này sẽ giúp cô lập EC2 compromised instance ra khỏi hệ thống mạng hiện tại.\nĐể tiến hành kiểm tra quá trình Remediation:\n Từ quy tắc GuardDuty-Event-EC2-MaliciousIPCaller, tại vùng Targets, ở mục Type là Lambda Function, chúng ta tìm kiếm Resource Name tương ứng.  Tại Lambda Function console, tìm kiếm Resource Name theo bước trước.  Chúng ta có thể xem xét một số mục  Configuration  Tại thanh Designer, chúng ta sẽ dễ dàng thấy mối quan hệ với EventBridge Event Rule. Ở phần Function code, những logic về coding sẽ được thực thi tại đây.   Permissions Monitoring     Xác nhận quá trình Remediation đã thành công\nĐể đảm bảo kết quả của quá trình Remediation, chúng ta cần phải xem xét EC2 instance đã bị cô lập hay chưa. Tại thời điểm này, bạn đã nhận được một E-mail cùng với một số thông tin quan trọng.\n Truy cập vào EC2 console ở us-west-2. Chọn Instances (Running), chúng sẽ thấy được 3 EC2 instance với tiền tố bắt đầu với định dạng sau GuardDuty-Example.  Dựa trên instance ID có từ GuardDuty Finding hay thông báo E-mail, chúng ta chọn EC2 instance tương ứng - GuardDuty-Example: Compromised Instance: Scenario 1.  Sau khi quá trình Remediation hoàn thành, chúng ta sẽ kiểm tra Security Group của EC2 compromised instance này, sẽ có định dạng tên tương tự sau ForensicSecurityGroup. ForensicSecurityGroup sẽ không có bất kỳ một quy tắc Ingress/Egress nào chứa địa chỉ IP trong Example-Threat-List.  Câu Hỏi Ôn Tập  Nguồn dữ liệu nào đã được GuardDuty sử dụng để xác định mối nguy hại này? Liệu việc cô lập có làm ảnh hưởng đến các ứng dụng đang vận hành bên trong EC2 instance này? Làm cách nào để chúng ta có thể thêm các thông tin chi tiết hơn ở các thông báo E-mail?  "
},
{
	"uri": "/vi/5-compromised-iam-credentials/",
	"title": "Compromised IAM credentials",
	"tags": [],
	"description": "",
	"content": "Tình huống 2: Compromised IAM credentials\nBạn đã hoàn thành tình huống giả lập tấn công đầu tiên và quay trở lại với tách cà phê của mình. Tuy nhiên, bạn lại tiếp tục nhận thêm những thông báo mới về những Findings liên quan tới các dịch vụ AWS IAM. Nội dung thông báo đầu tiên chỉ ra rằng, bằng cách sử dụng IAM credentials, một số API calls đã được thực hiện từ địa chỉ IP đã được thêm vào Threat List (ở bài trước).\nKhông có bất kỳ IAM credentials cá nhân nào đã từng bị phơi bày hay lộ ra dưới bất kỳ hình thức nào.\n\rNội dung\n Kiến Trúc Tổng Quan Quá Trình Điều Tra Cấu Hỏi Ôn Tập  Kiến Trúc Tổng Quan  EC2 \u001dmalicious instance này tiến hành thực hiện các API calls, EIP của instance này đã được thêm vào Threat List. Nội dung các API calls đã được lưu lại trong nhật ký của CloudTrail. GuardDuty quan sát nhật ký của CloudTrail Logs cùng với VPC Flow Logs và DNS Logs, qua đó đánh giá tình hình dựa trên một số cơ sở nhất định. GuardDuty tạo ra những Findings tương ứng và đồng thời gửi chi tiết đến GuardDuty Console và EventBridge Events. EventBridge Event Rule tiến hành kích hoạt SNS Topic. SNS Topic tiến hành gửi thông báo E-mail cùng với thông tin liên quan.  Quá Trình Điều Tra  Truy cập GuardDuty Console\nĐể tiến hành xem xét các Findings:\n Truy cập vào GuardDuty Console ở us-west-2 Chúng ta sẽ thấy được các Findings với định dạng như sau.  Recon:IAMUser. UnauthorizedAccess:IAMUser.    Nếu không có bất kỳ Finding nào, tiến hành nhấn nút Refresh và đợi. Từ Finding - Recon:IAMUser/MaliciousIPCaller.Custom, chúng ta có thể dễ dàng truy xuất một số thông tin sau:  Chuyện gì đã xảy ra? Tài nguyên AWS nào bị ảnh hưởng? Sự kiện này xảy ra khi nào?   Ở dưới phần Resource Affected, bạn sẽ kiếm được User Name mà liên quan đến Finding này.   Dựa trên định dạng đã được xem xét chi tiết ở phần trước, bạn có thể xác định chính xác sự cố bảo mật nào thông qua kiểu Finding?\n Finding này chỉ ra rằng IAM credential của User Name trên đã có thể bị phơi bày bởi những API calls xuất phát từ địa chỉ IP mà trước đó đã được thêm vào Threat List.\n Vậy những hành động nào đã được IAM User này thực hiện?\n Ở mục Action, chúng ta thấy được hành động DescribeParameters đã được thực hiện.\n Làm thế nào để chúng ta có thể thấy được hết các hành động còn lại, được thực hiện bởi IAM User này, trong vòng 1 tiếng trước hay 1 ngày truớc?\n GuardDuty có khả năng phân tích một lượng lớn dữ liệu nhằm xác định chính xác mối nguy hiểm có mặt trong môi trường của bạn. Tuy nhiên, trong quá trình điều tra và các bước thực hiện Remediation, chúng ta cũng cần kết hợp nhiều nguồn dữ liệu khác nhau để có một cái nhìn tương quan nhất có thể.\nTrong trường hợp này, nhà phân tích có thể sử dụng các thông tin chi tiết có thể tìm thấy trong nhật ký hành vi người dùng thông qua CloudTrail.\nNhững Findings về IAM được sinh ra bởi EC2 \u001dmalicious instance đã thực hiện những API calls và EIP của instance này nằm trong Custom Threat List.\n\r Kiểm tra EventBridge Event Rule\n Truy cập vào CloudWatch Console ở us-west-2. Ở thanh điều hướng bên tay trái, dưới Events, chọn Rules. Bạn sẽ thấy có 3 quy tắc đã được thiết lập (bởi CloudFormation Template), bắt đầu với tiền tố có dạng sau GuardDuty-Event.. Tiến hành chọn quy tắc có tên là GuardDuty-Event-IAMUser-MaliciousIPCaller.  Bạn sẽ dễ dàng nhận thấy chỉ có 1 mục tiêu tại vùng Targets là SNS Topic.  Hoá ra, Alice chưa từng thiết lập Lambda Function để thực hiện quá trình Remediation bởi đội ngũ Security đã đưa ra quyết định rằng họ sẽ tiến hành một cách thủ công đối với Finding này.\n Sự kết hợp giữa GuardDuty và EventBridge Events mang lại sự uyển chuyển giúp cho chúng ta dễ dàng tạo ra một quy trình Remediation tự động hoá. Lambda function hay giải pháp đến từ phía đối tác của AWS là những lựa chọn hàng đầu.\n Đối với một số Finding nhất định, chúng ta có thể sẽ chỉ cấu hình thông báo và giải quyết vấn đề một cách thủ công, thay vì tự động hoá. Bởi khi thiết kế quá trình tự động hoá, chúng ta sẽ phải vô cùng lưu ý và đánh giá kết quả mà quá trình Remediation mang lại, bao gồm cả ưu điểm và nhược điểm.\n Ngoài ra, chúng ta có thể thiết lập Target đối một số tài nguyên AWS khác như SSM Run Commands hay Step Function State Machine.\n  Giải quyết tình hình\nBởi Alice chưa từng thiết lập quá trình Remediation đối với Finding này, chúng ta cần phải thực hiện một cách thủ công. Trong khi đội ngũ Security đang tiến hành phân tích những hành vi của IAM user này để xác định rõ hơn phạm vi lỗ hổng, chúng ta cần phải thực hiện một số bước để vô hiệu hoá Access Key nhằm ngăn chặn lập tức những hành động tiếp theo.\n Truy cập vào IAM Console. Ở thanh điều hướng bên tay trái, chọn Users.  Dựa trên GuardDuty Finding và thông báo E-mail, chúng ta dễ dàng chọn ra được IAM user - GuardDuty-Example-Compromised-Simulated. Ở user GuardDuty-Example-Compromised-Simulated, chúng ta chọn thanh Security Credentials.  Ở mục Access Keys, dựa trên thông tin Access Key ID từ Finding, chúng ta tiến hành nhấn nút Make Inactive.  Cấu Hỏi Ôn Tập  Nguồn dữ liệu nào đã được GuardDuty sử dụng để xác định mối nguy hại này? Những Permissions nào mà IAM user được cho phép sử dụng? Tại sao đội ngũ Security quyết định đi ngược lại với quá trình Remediation tự động hoá?  "
},
{
	"uri": "/vi/6-iam-role-credential-exfiltration/",
	"title": "Credential Exfiltration",
	"tags": [],
	"description": "",
	"content": "Tình huống 3: IAM Role Credential Exfiltration\nNội dung\n Tạo ra Finding một cách thủ công IAM Role Credential Exfiltration  "
},
{
	"uri": "/vi/7-summary/",
	"title": "Tóm lược",
	"tags": [],
	"description": "",
	"content": "Thông qua bài thực hành này, chúng ta đã thực hiện các bước liên quan đến việc sinh ra và phân tích các Findings, qua đó tiến hành thực hiện quá trình Remediation tương ứng nhằm giải quyết vấn đề ngay lập tức.\n   Finding Scenario     UnauthorizedAccess:EC2/MaliciousIPCaller.Custom Compromised EC2 Instance   Recon:IAMUser/MaliciousIPCaller.Custom Compromised IAM credentials   UnauthorizedAccess:IAMUser/MaliciousIPCaller.Custom Compromised IAM credentials   UnauthorizedAccess:IAMUser/InstanceCredentialExfiltration IAM Role credential exfiltration    "
},
{
	"uri": "/vi/8-environment-cleanup/",
	"title": "Dọn dẹp tài nguyên",
	"tags": [],
	"description": "",
	"content": "Để tiến hành dọn dẹp các tài nguyên AWS được dùng trong bài thực hành này, chúng ta lần lượt thực hiện các bước sau:\n Xoá S3 bucket mà được tạo bởi CloudFormation Template với định dạng guardduty-example. Bước này bắt buộc phải thực hiện bởi CloudFormation Stack sẽ không thể bị xoá nếu S3 bucket mà tồn tại dữ liệu bên trong. Xoá IAM Role mà được dùng cho EC2 compromised instance với định dạng GuardDuty-Example-EC2-Compromised. Bởi trong một quá trình Remediation, Lambda Function đã tiến hành thêm một IAM Policy, CloudFormation Stack sẽ không thể bị xoá nếu IAM Role xuất hiện thêm các IAM Policy khác. Xoá Custom Threat List được sử dụng cho GuardDuty. Vô hiệu hoá dịch vụ Amazon GuardDuty.  Truy cập vào GuardDuty Console. Nhân vào mục Settings. Chọn Disable GuardDuty và nhấn Save.   Xoá CloudFormation Stack. Nếu bạn không thể xoá được, hãy kiểm tra lại bước 2 bước đầu tiên.  "
},
{
	"uri": "/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]